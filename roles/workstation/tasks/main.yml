---
- name: set vi to be default editor
  alternatives: name=editor path=/usr/bin/vi
- name: add ansible group
  group: name=ansible state=present

# TODO: Complete when I can find the name of the
# Server based on an AWS tag
##@#- name: Set Hostname
##@#  lineinfile:
##@#    dest=/etc/sysconfig/network
##@#    line='HOSTNAME=localhost.localdomain'
##@#    regexp="^HOSTNAME=localhost.localdomain$"

# tasks file for workstation
- name: Create user gmatz
  user: name=gmatz state=present groups=ansible

- name: Set up authorized_keys for gmatz
  authorized_key: user=gmatz
                  key="{{ item }}"
  with_file:
    - public_keys/gmatz

- include: Debian.yml
  when: ansible_os_family in ['Debian', 'Ubuntu','Peppermint', 'Linuxmint']

- include: Redhat.yml
  when: ansible_os_family in ['RedHat', 'Fedora','Centos']

- name: Install PIP packages
  pip: name={{ item }} state=present
  with_items: install_pip_list

- name: Install byobu launcher
  sudo_user: gmatz
  sudo: yes
  command: byobu-launcher-install
  changed_when: False

- name: Enable vi mode in .rc files
  lineinfile:
    dest=~{{ item[0] }}/{{ item[1] }}
    line="set -o vi"
    regexp="^set -o vi"
    create=yes
  with_nested:
    - [ 'root', 'gmatz' ]
    - [ '.bashrc',  '.bash_profile' ,'.profile' ]

- name: Enable byobu in .rc files
  lineinfile:
    dest=~{{ item[0] }}/{{ item[1] }}
    line="_byobu_sourced=1 . /usr/bin/byobu-launch"
    regexp="_byobu_sourced=1"
    insertafter=EOF
    create=yes
  with_nested:
    - [ 'root', 'gmatz' ]
    - [ '.bash_profile' ,'.profile' ]

- name: Enable byobu in .bashrc files
  lineinfile:
    dest=~gmatz/.bashrc
    line='{{ byobu_line }}'
    regexp="byobu-prompt"
    insertafter=EOF
    create=yes

- name: Setup up git email
  command: /usr/bin/git config --global user.email "gmatz@mdsol.com"
  sudo_user: gmatz
  changed_when: False

- name: Setup up git email
  command: /usr/bin/git config --global user.name "Guy Matz"
  sudo_user: gmatz
  changed_when: False

- name: check out newest version of ansible
  git: repo=https://github.com/ansible/ansible.git
       dest=/opt/ansible
